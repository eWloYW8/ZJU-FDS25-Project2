# 代数表达式的自动求导

在 Torch 和 TensorFlow 等框架中，自动求导技术的应用极大地促进了基于反向传播的深度学习算法的实现和训练。现在，我们希望实现一个用于代数表达式的自动求导程序。

## 输入格式

首先，输入一个中缀表达式，该表达式由以下符号组成。

### 运算符

| 类型    | 示例    | 备注             |
| ----- | ----- | -------------- |
| 括号    | `( )` |                |
| 幂运算   | `^`   |                |
| 乘法与除法 | `* /` |                |
| 加法与减法 | `+ -` |                |
| 参数分隔符 | `,`   | 可选，仅在多元函数参数中使用 |

以上运算符按优先级从高到低排列。例如，`a+b^c*d` 会被解析为 `a + ((b ^ c) * d)`。

### 数学函数（附加功能）

| 函数                           | 描述                                                        |
| ---------------------------- | --------------------------------------------------------- |
| `ln(A)`, `log(A, B)`         | 对数函数。`ln(A)` 表示 `A` 的自然对数，`log(A, B)` 表示以 `A` 为底 `B` 的对数。 |
| `cos(A)`, `sin(A)`, `tan(A)` | 基本三角函数。                                                   |
| `pow(A, B)`, `exp(A)`        | 指数函数。`pow(A, B)` 表示 `A` 的 `B` 次幂，`exp(A)` 表示 `A` 的自然指数函数。 |

### 操作数

| 类型   | 示例                | 备注                                    |
| ---- | ----------------- | ------------------------------------- |
| 文字常数 | `2 3 0 -5`        | 仅考虑由纯数字和负号组成的整数。                      |
| 变量   | `ex cosval xy xx` | 预留关键字包括上述数学函数。非关键字的由小写英文字母组成的标识符视为变量。 |

## 输出方式

对于表达式中出现的每个变量（定义见上），输出一个表示输入表达式对该变量求导后的算术表达式。输出需遵循以下规则：

- 变量按**字典序**排序。
- 对于每个变量，打印两行字符串：
  - 变量名。
  - 该变量对应的导数表达式。
- 两个字符串用 `:` 分隔。

### 示例输出格式

```
a: 1
b: c*b^(c-1)*d
c: ln(b)*b^c*d
d: b^c
```

## 需求

- 处理包含**运算符**和**操作数**的代数表达式。
- 输出**对原表达式的导数表达式**，分别针对每个变量求导。
- 确保求导结果正确，但不要求进行化简或展开。
- 使用**C/C++** 实现，仅使用**标准库**。
- 代码应**可读性强**或**注释充分**。
- 确保源文件可正确使用 **UTF-8 编码** 打开。

### 附加要求

- **避免使用 STL 复杂容器**。
- **支持包含数学函数的表达式**。
- **应用至少两条化简规则**，以减少输出表达式的长度。

## 提示

1. **从中缀表达式构建表达式树**。

2. **简单输入示例**：

   **输入：**

   ```
   a+b^c*d
   ```

   **输出：**

   ```
   a: 1
   b: c*b^(c-1)*d
   c: ln(b)*b^c*d
   d: b^c
   ```

   **输入：**

   ```
   a*10*b+2^a/a
   ```

   **输出：**

   ```
   a: 10*b-2^a/a^2+2^a*ln(2)/a
   b: a*10
   ```

   **输入：**

   ```
   xx^2/xy*xy+a^a
   ```

   **输出：**

   ```
   a: a^a*(1+ln(a))
   xx: 2*xx
   xy: 0
   ```

3. **更多输入示例：**
   - `x*ln(y)`
   - `x*ln(x*y)+y*cos(x)+y*sin(2*x)`
   - `log(a,b)/log(c,a)`

## 评分标准

| 章节        | 描述    | 分数   |
| --------- | ----- | ---- |
| **第 1 章** | 介绍    | 6 分  |
| **第 2 章** | 算法规范  | 12 分 |
| **第 3 章** | 测试结果  | 20 分 |
| **第 4 章** | 分析与评价 | 10 分 |
| **代码实现**  | 代码及注释 | 50 分 |
| **文档风格**  | 书写规范  | 2 分  |

**附加奖励：**

- **优秀解决附加功能的方案可额外加 5% 分数**。
